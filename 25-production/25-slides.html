<!DOCTYPE html>
<html>
  <head>
    <title>CSCI 4830-009: Open Source Development</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <style type="text/css">
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
    </style>
    <style type="text/css">
	.remark-slide-content { 
		background-size: 100% 100%;
	}
	.invert {
		color: #fdd;
	}
	.footnote {
		position: absolute;
		bottom: 3em;
		color: #f06; 
	}
	img {
		width: 100%;
	}
	.hero {
		color: #22a; 
		background-color: #eee;
		padding: 4px;
		font-size: 100px;
	}
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

# CSCI 4830-009

## Open Source Development
## Spring, 2017
## Ned McClain

---
class: center, middle

# Welcome!

--

## Today: HA Design, Lessons, Analytics
---
background-image: url(images/xkcd.png)
---
background-image: url(images/slack1.png)
---
## 1. Slack, et al, are paid services with closed memberships. The content inside those systems is closed. I cannot link to a discussion in a Slack channel in a tweet. I cannot refer to it in an issue report, and I cannot cite it in a presentation. Knowledge is silo’d to those who have the time and ability to participate in chat services in real time.
---
## 2. Slack, et al, are based on synchronous communication, which discriminate against those who do not or can not take part of the conversation in real time. For example, real time chat discriminates against those who aren’t in the same time zone–you can’t participate fully in an open source project if all the discussion happens while you’re asleep.
---
## Even if you are in the same time zone, real time chat assumes a privilege that you have the spare time–or an employer who doesn’t mind you being constantly distracted–to be virtually present in a chat room. Online chat clients are resource hogs, and presume the availability of a fast computer and ample, always on, internet connection, again raising the bar for participation.
---
## In my view these issues are inseparable. Calls to use IRC instead, miss the point that IRC is similarly real-time, just as efforts to create a post facto log of a Slack channel miss the fact that this is a record of a conversation which others cannot contribute equally.

## There is no solution for equitable open source communication that does not address both simultaneously.
---
# Prefer asynchronous communication for open source projects

## Instead of closed, synchronous, systems I recommend open source projects stick to asynchronous communication tools that leave a publicly linkable, searchable, url. The tools that fit this requirement best are; mailing list, issue trackers, and forums.
---
class: center, middle
# Design for High Availability

---
# Disposable Resources Instead of Fixed Servers

--

## Dynamic provisioning and configuration drift

--

## Immutable Infrastructure and Pets vs Cattle

--

## Golden Images and Infra as Code

---
# Loose Coupling

### Monolith -> SOA -> Microservices

--

### Well-Defined Interfaces

--

### Service Discovery

--

### Asynchronous Integration

--

### Circuit Breakers

--

### Graceful Failure

---
# Fail Sanely
## Sanitize and validate configuration inputs, and respond to implausible inputs by both continuing to operate in the previous state and alerting to the receipt of bad input.

---
# Fail Sanely

## Incorrect data: Validate both syntax and, if possible, semantics. Watch for empty data and partial or truncated data (e.g., alert if the configuration is N% smaller than the previous version).

## Delayed data: This may invalidate current data due to timeouts. Alert well before the data is expected to expire.
---
## In 2005, Google’s global DNS load- and latency-balancing system received an empty DNS entry file as a result of file permissions. It accepted this empty file and served NXDOMAIN for six minutes for all Google properties. In response, the system now performs a number of sanity checks on new configurations, including confirming the presence of virtual IPs for google.com, and will continue serving the previous DNS entries until it receives a new file that passes its input checks.

---
## In 2009, incorrect (but valid) data led to Google marking the entire Web as containing malware. A configuration file containing the list of suspect URLs was replaced by a single forward slash character (/), which matched all URLs. Checks for dramatic changes in file size and checks to see whether the configuration is matching sites that are believed unlikely to contain malware would have prevented this from reaching production.

---
# Fail Sanely
# Fail in a way that preserves function, possibly at the expense of being overly permissive or overly simplistic. It’s generally safer for systems to continue functioning with their previous configuration and await a human’s approval before using the new, perhaps invalid, data.

---
background-image: url(images/gcp.png)
---
background-image: url(images/gcp2.png)
---
# Backing Services

## Is this a read-heavy, write-heavy, or balanced workload? How many reads and writes per second are you going to need? How will those values change if the number of users increases?

## What are your latency requirements? How many concurrent users do you need to support?

---
class: center, middle
# "premature optimization is the root of all evil."

# -- Sir Tony Hoare (popularized by Donald Knuth)

---
# Backing Services

## How much data will you need to store and for how long? How quickly do you foresee this will grow? Is there an upper limit in the foreseeable future? What is the size of each object (average, min, max)? How are these objects going to be accessed?

## What are the requirements in terms of durability of data? Is this data store going to be your “source of truth”?


---
# Backing Services
## What is your data model and how are you going to query the data? Are your queries relational in nature (e.g., JOINs between multiple tables)?  Could you denormalize your schema to create flatter data structures that are easier to scale?

---
# Backing Services
## What kind of functionality do you require? Do you need strong integrity controls or are you looking for more flexibility (e.g., schema-less data stores)? Do you require sophisticated reporting or search capabilities?  Are your developers more familiar with relational databases than NoSQL?

---
# Removing Single Points of Failure 

## Standby vs Active Redundancy
## Failure Detection / Healthchecking
## Durable Data Storage and Backups
## Geographic Redundancy
## Fault Isolation and Sharding

---
# Architect for Scalability

### A scalable architecture can support growth in users, traffic, or data size with no drop in performance.
### It should provide that scale in a linear manner where adding extra resources results in at least a proportional increase in ability to serve additional load.
### Growth should introduce economies of scale, and cost should follow the same dimension that generates business value out of that system. 

---
# Scalability ingredients

## Vertical vs Horizontal scaling

## Stateful vs Stateless components

## Reliable backing services
---
# Caching

## In-DB caching
## Application in-memory caching
## Edge Caching
## Browser Caching

---
# Design for Simplicity

# "The price of reliability is the pursuit of the utmost simplicity." -- C.A.R. Hoare, Turing Award lecture

---
# Design for Simplicity

### Stability Versus Agility
### The Virtue of Boring
### Essential complexity and accidental
### The "Negative Lines of Code" Metric
### Minimal APIs
### Release Simplicity

---
# Design for Simplicity

# "Unlike a detective story, the lack of excitement, suspense, and puzzles is actually a desirable property of source code." -- Google engineer Robert Muth

---
background-image: url(images/boring1.png)
---
background-image: url(images/boring2.jpg)
---
class: center, middle
# The nice thing about boringness is that the capabilities of these things are well understood. But more importantly, their failure modes are well understood.  -- Dan McKinley
---
background-image: url(images/boring3.png)
---
background-image: url(images/boring4.png)
---
class: center, middle
## Let's say every company gets about three innovation tokens. You can spend these however you want, but the supply is fixed for a long while. 
---
class: center, middle
## If you choose to write your website in NodeJS, you just spent one of your innovation tokens. If you choose to use MongoDB, you just spent one of your innovation tokens. If you choose to use service discovery tech that's existed for a year or less, you just spent one of your innovation tokens. If you choose to write your own database, oh god, you're in trouble.

---
class: center, middle
## Any of those choices might be sensible if you're a javascript consultancy, or a database company. But you're probably not. You're probably working for a company that is at least ostensibly rethinking global commerce or reinventing payments on the web or pursuing some other suitably epic mission.

---
class: center, middle
## In that context, devoting any of your limited attention to innovating is an excellent way to fail. Or at best, delay success [1].
---
# Choose New Technology, Sometimes.

## Taking this reasoning to its reductio ad absurdum would mean picking Java, and then trying to implement a website without using anything else at all. And that would be crazy. You need some means to add things to your toolbox.
---
# Choose New Technology, Sometimes.

## 1. Consider how you would solve your immediate problem without adding anything new. First, posing this question should detect the situation where the "problem" is that someone really wants to use the technology. If that is the case, you should immediately abort.

---
# Choose New Technology, Sometimes.
## 2. Write down exactly what it is about the current stack that makes solving the problem prohibitively expensive and difficult.
---
# Choose New Technology, Sometimes.

## 3. New technology choices might be purely additive, but they might also overlap or replace things you are already using. If that's the case, you should set clear expectations about migrating old functionality to the new system. The policy should typically be "we're committed to migrating," with a proposed timeline. 

---
## Polyglot programming is sold with the promise that letting developers choose their own tools with complete freedom will make them more effective at solving problems. This is a naive definition of the problems at best, and motivated reasoning at worst. The weight of day-to-day operational toil this creates crushes you to death.

---
class: center, middle
## Mindful choice of technology gives engineering minds real freedom: the freedom to contemplate bigger questions. Technology for its own sake is snake oil. -- Dan McKinley

---
background-image: url(images/sysdes.png)
---
background-image: url(images/sysdes1.png)
---
# Lessons from Other Industries

--

### Are the principles used in DevOps also important outside of tech, or do other industries tackle the requirements of high reliability in markedly different ways?

--

### If other industries also adhere to DevOps principles, how are the principles manifested?

--

### What are the similarities and differences in the implementation of these principles across industries?

--

### What factors drive similarities and differences in implementation?

--

### What can the tech industry learn from these comparisons?

---
# Four Key Themes of Learning:

## 1. Preparedness and Disaster Testing
## 2. Postmortem Culture
## 3. Automation and Reduced Operational Overhead
## 4. Structured and Rational Decision Making
---
# 1. Preparedness and Disaster Testing

## "Hope is not a strategy." -- Google SRE Team

## "The SRE culture is forever vigilant and constantly questioning: What could go wrong? What action can we take to address those issues before they lead to an outage or data loss?"

---
# In DR testing, push production systems to the limit and inflict actual outages in order to:

## Ensure that systems react the way we think they will
## Determine unexpected weaknesses
## Figure out ways to make the systems more robust in order to prevent uncontrolled outages

---
# Preparedness and Disaster Testing Strategies Outside Tech

### Relentless organizational focus on safety
### Attention to detail & Swing capacity
### Simulations and live drills
### Training and certification
### Obsessive focus on detailed requirements gathering and design
### Defense in depth
---
# Relentless Organizational Focus on Safety

### "Every management meeting started with a discussion of safety."

--

### Highly defined processes that are strictly followed at every level of the organization.
### Workers feel empowered to speak up if and when anything seems amiss.
### In the case of nuclear power, military aircraft, and railway signaling industries, safety standards for software are well detailed (e.g., UK Defence Standard 00-56, IEC 61508, IEC513, US DO-178B/C, and DO-254).
---
# Attention to Detail

### From his time spent in the US Navy, Jeff Stevenson recalls an acute awareness of how a lack of diligence in executing small tasks (for example, lube oil maintenance) could lead to major submarine failure. A very small oversight or mistake can have big effects. Systems are highly interconnected, so an accident in one area can impact multiple related components. The nuclear Navy focuses on routine maintenance to ensure that small issues don't snowball.

---
# Swing Capacity

## System utilization in the telecom industry can be highly unpredictable. Absolute capacity can be strained by unforeseeable events such as natural disasters, as well as large, predictable events like the Olympics. According to Gus Hartmann, the industry deals with these incidents by deploying swing capacity in the form of a SOW (switch on wheels), a mobile telco office.

---
# Simulations and Live Drills

## The potential consequences of a system outage determine whether using a simulation or a live drill is appropriate.

--

### The aviation industry can't perform a live test "in production" without putting equipment and passengers at risk. Instead, they employ extremely realistic simulators with live data feeds, in which the control rooms and equipment are modeled down to the tiniest details to ensure a realistic experience without putting real people at risk.
---
# Simulations and Live Drills

## The telecom industry typically focuses on live drills centered on surviving hurricanes and other weather emergencies.
## The US nuclear Navy uses a mixture of "what if" thought exercises and live drills.
## The live drills involve "actually breaking real stuff but with control parameters. Live drills are carried out religiously, every week, two to three days per week."

---
# Training and Certification

## Training and certification are particularly important when lives are at stake.
## Lifeguards complete a rigorous training certification, in addition to a periodic recertification process.
## Navy officers spend 20% or more time in ongoing training.
---
# Focus on Detailed Requirements Gathering and Design

## Detailed requirements gathering and design docs are particularly important when working with medical devices.
## Space sciences, aviation, military.
## Many other industries have very different pressures, risk appetites, and requirements, and their processes are very much informed by these circumstances.

---
background-image: url(images/zuck1.jpg)
---
background-image: url(images/zuck2.jpg)
---
# Defense in Depth and Breadth

## In the nuclear power industry, defense in depth is a key element to preparedness.

--

### Nuclear reactors feature redundancy on all systems and implement a design methodology that mandates fallback systems behind primary systems in case of failure.
### The system is designed with multiple layers of protection, including a final physical barrier to radioactive release around the plant itself.

---
background-image: url(images/fuku.jpg)

---
# Postmortem Culture

## Corrective and preventative action (CAPA) is a well-known concept for improving reliability that focuses on the systematic investigation of root causes of identified issues or risks in order to prevent recurrence.

## This principle is embodied by a culture of blameless postmortems.

---
### Postmortems should be blameless and focus on process and technology, not people. Assume the people involved in an incident are intelligent, are well intentioned, and were making the best choices they could given the information they had available at the time.

--

### It follows that we can’t “fix” the people, but must instead fix their environment: e.g., improving system design to avoid entire classes of problems, making the appropriate information easily available, and automatically validating operational decisions to make it difficult to put systems in dangerous states.

---
## This exercise is undertaken without pointing fingers at any individual. Instead of assigning blame, it is far more important to figure out what went wrong, and how, as an organization, we will rally to ensure it doesn't happen again. Dwelling on who might have caused the outage is counterproductive. Postmortems are conducted after incidents and published across teams so that all can benefit from the lessons learned.

---
# When something goes wrong it's important to evaluate all of the following:

## What happened
## Intentions and assumptions
## The effectiveness of the response
## What we would do differently next time

---
# Postmortems: Different motivations in different industries

--

## Heavily regulated by specific government authorities: FCC, FAA, OSHA, FDA, NHTSA, NTSB, NRC, and similar in the EU.
## "Near miss" events in manufacturing, chemical production, civil engineering, and medical practice.
## "If a lifeguard's feet go in the water, there will be paperwork!"
---
# 3. Automating Away Repetitive Work and Operational Overhead

## Industries are mixed in terms of if, how, and why they embrace automation.


---
# Certain industries trust humans more than machines:	

--

### The US nuclear Navy eschewed automation in favor of a series of interlocks and administrative procedures.
### The Navy was also concerned that automation and computers move so rapidly that they are all too capable of committing a large, irreparable mistake. When you are dealing with nuclear reactors, a slow and steady methodical approach is more important than accomplishing a task quickly.
### Finance / Knight Capital
### "If we aren't trading, we aren't losing money. We aren't making money either, but at least we aren't losing money." -- John Li

---

## Certain industries trust machines more than humans:

--

### Elevators

--

### Manufacturing, Nuclear (30 minute rule)
### LASIK, pacemakers, defibrillators, and organ transplants
### Aviation applies automation selectively

---
background-image: url(images/airfrance1.png)
---
class: center, middle
## It seems to have been rooted in the very advances in piloting and aircraft design that have improved airline safety over the past 40 years. To put it briefly, automation has made it more and more unlikely that ordinary airline pilots will ever have to face a raw crisis in flight—but also more and more unlikely that they will be able to cope with such a crisis if one arises. Moreover, it is not clear that there is a way to resolve this paradox. 

---
class: center, middle
## But worse—far worse—was what Bonin did in the vertical sense: he pulled the stick back. Initially this may have been a startle response to the false indication of a minor altitude loss. But Bonin didn’t just ease the stick back—he hauled it back, three-fourths of the way to the stop, and then he kept on pulling. Alain Bouillard, the French investigator, equated the reaction to curling instinctively into a fetal position. The airplane responded by pitching up into an unsustainable climb, causing its speed to slow and its angle of attack to increase.

---
background-image: url(images/airfrance2.jpg)
---
class: center, middle
## The Airbus flight-control system... to the extent that it embodies a mistake in design, it is that the pilot’s and co-pilot’s side-sticks are not linked and do not move in unison. This means that when the Pilot Flying deflects his stick, the other stick remains stationary, in the neutral position. If both pilots deflect their sticks at the same time, a DUAL INPUT warning sounds, and the airplane responds by splitting the difference. To keep this from causing a problem in the case of a side-stick jam, each stick has a priority button that cuts out the other one and allows for full control.
---
class: center, middle
## The arrangement relies on clear communication and good teamwork to function as intended.

---
background-image: url(images/airfrance2.jpg)
---
# 4. Structured and Rational Decision Making

## Data-driven decision making:

## The basis for the decision is agreed upon advance, rather than justified ex post facto
## The inputs to the decision are clear
## Any assumptions are explicitly stated
## Win over feelings, hunches, or the opinion of the most senior employee in the room

---
# Real-time decision making

## Decisions should be informed rather than prescriptive, without deference to personal opinions—even that of the "HiPPO".
## Focus on playbooks and procedures rather than open-ended problem solving.
## Culture that relies heavily on formulating, testing hypotheses, and separation of duties.

---
# The lessons already learned by well-established industries likely inspired some of the practices in use in tech today.

### In many cases, tech/internet/computers industry has a higher appetite for velocity than players in most other industries.
### The ability to move or change quickly must be weighed against the differing implications of a failure.
### When the stakes are high, a conservative approach to achieving high reliability is warranted.

---
# The lessons already learned by well-established industries likely inspired some of the practices in use in tech today.
### Walking a tightrope between user expectations for high reliability versus a focus on rapid change and innovation.
### It's a complicated equation that balances scale, complexity, and velocity with high reliability.

---
# Analytics: Why measure anything?

--

## Data, when used wisely, can help you make better decisions as an open source maintainer.

---
# Why measure anything?  With more information, you can:

### Understand how users respond to a new feature
### Figure out where new users come from
### Identify, and decide whether to support, an outlier use case or functionality
### Quantify your project’s popularity and understand how your project is used
### Raise money through sponsorships and grants
---
class: center, middle
## "Homebrew is provided free of charge and run entirely by volunteers in their spare time. As a result, we do not have the resources to do detailed user studies of Homebrew users to decide on how best to design future features and prioritise current work. Anonymous aggregate user analytics allow us to prioritise fixes and features based on how, where and when people use Homebrew."
---
# Popularity isn’t everything. Everybody gets into open source for different reasons. If your goal as an open source maintainer is to show off your work, be transparent about your code, or just have fun, some metrics may not be important to you.
---
# Open Source Lifecycle Metrics

## 1. Tracking Discovery
## 2. Tracking Usage
## 3. Tracking Retention
## 4. Tracking Maintainer Activity
---
# 1. Tracking Discovery

## Before anybody can use or contribute back to your project, they need to know it exists. Ask yourself: are people finding this project?
---
background-image: url(images/metrics1.png)
---
background-image: url(images/goog.png)
---
background-image: url(images/goog2.png)
---
# Growth

## Project Demo Site
## Meetups, & Hackathons
## Student Projects
## Content Marketing & Social
## Growth Hacking

---
background-image: url(images/price1.png)
---
background-image: url(images/price2.png)
---
background-image: url(images/price3.png)
---
background-image: url(images/price4.png)
---
background-image: url(images/minio.png)

---
# 2. Tracking Usage

## Ideally, when they see your project, they’ll feel compelled to do something. The second question you’ll want to ask is: are people using this project?
---
background-image: url(images/metrics2.png)
---
background-image: url(images/metrics3.png)
---
background-image: url(images/metrics4.png)
---
background-image: url(images/metrics5.png)
---
## If usage is low compared to the number of people discovering your project, there are two issues to consider. Either:

### Your project isn’t successfully converting your audience, or
### You’re attracting the wrong audience

---
# 3. Tracking Retention

## The next question you’ll want to ask yourself is: are people contributing back to this project?
---
# Community retention metrics
## Total contributor count and number of commits per contributor
### Tells you how many contributors you have, and who’s more or less active.
![](images/metrics6.png)
---
# Community retention metrics
## First time, casual, and repeat contributors
### Helps you track whether you’re getting new contributors, and whether they come back. (Casual contributors are contributors with a low number of commits. Whether that’s one commit, less than five commits, or something else is up to you.) Without new contributors, your project’s community can become stagnant.
---
# Community retention metrics
## Number of open issues and open pull requests
### If these numbers get too high, you might need help with issue triaging and code reviews.
---
# Community retention metrics
## Number of opened issues and opened pull requests
### Opened issues means somebody cares enough about your project to open an issue. If that number increases over time, it suggests people are interested in your project. Too many may indicate software or documentation quality issues.
---
# Community retention metrics
## Types of contributions
### For example, commits, fixing typos or bugs, or commenting on an issue.
---
background-image: url(images/metrics7.png)
---
# 4. Tracking Maintainer Activity

## Finally, you’ll want to close the loop by making sure your project’s maintainers are able to handle the volume of contributions received. The last question you’ll want to ask yourself is: am I (or are we) responding to our community?

---
background-image: url(images/metrics8.png)
---
# Maintainer Engagement

### Average and worst-case time to respond to issue or a pull request.
### Average and worst-case time to respond to pull request.
### Average time an issue remains open.
### Whether issues get closed by PRs.
### Whether stale issues get closed.
### Average time to merge a pull request.

---
background-image: url(images/wbw.png)
---
class: center, middle

# Before Wednesday: email with your homework grades
# Wednesday: Security, Resources, and Project Presentation Details

    </textarea>
    <script src="../remark.min.js" type="text/javascript"></script>
    <script type="text/javascript">var slideshow = remark.create({countIncrementalSlides: true});</script>
  </body>
</html>
